<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Infinie & gratuit — Convertisseur Crypto ↔ EUR</title>
  <meta name="color-scheme" content="dark"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0B0B0D; --panel:#0d1120; --text:#E6ECF7; --muted:#A4ADBD;
           --border:rgba(95,123,255,0.18); --accent1:#2FE3FF; --accent2:#1B4CFF; --ring:0 0 0 2px rgba(43,167,255,.35); }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:
        radial-gradient(1200px 600px at 8% 12%, rgba(43,167,255,0.12), transparent 60%),
        radial-gradient(1000px 800px at 82% 85%, rgba(27,76,255,0.10), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .container{max-width:1100px;margin:0 auto;padding:32px 20px 80px}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:24px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
    .logo{width:28px;height:28px;border-radius:999px;background:radial-gradient(circle at 30% 30%,var(--accent1),var(--accent2));display:grid;place-items:center;color:#fff;font-weight:800}
    .badge{padding:6px 10px;font-size:12px;border-radius:999px;background:#0f1420;color:#9fb4ff;border:1px solid #1a2340}
    .title{font-size:42px;margin:6px 0 8px;line-height:1.1}
    .small{font-size:12px;color:var(--muted)}
    .grid{display:grid;gap:20px;grid-template-columns:1.1fr .9fr}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .panel{
      background:linear-gradient(160deg, rgba(27,76,255,0.06), transparent),
                 linear-gradient(180deg, rgba(47,227,255,0.05), transparent 40%), var(--panel);
      border:1px solid var(--border); border-radius:16px; padding:18px;
      box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03); position:relative;
    }
    .field{margin-bottom:16px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:8px}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .input, select{
      width:100%; background:#0b0f1a; color:var(--text); border:1px solid #1a2340; border-radius:12px;
      padding:12px 14px; font-size:14px; outline:none;
    }
    .input:focus, select:focus{ box-shadow:var(--ring); border-color:#3a63ff }
    .btn{ background:#0b0f1a;border:1px solid #1a2340;color:var(--text); border-radius:12px;padding:12px 14px;font-size:14px;cursor:pointer;user-select:none;font-weight:700 }
    .btn:hover{ box-shadow:var(--ring); border-color:#3a63ff }
    .btn.primary{ background: linear-gradient(90deg, var(--accent1), var(--accent2)); border:none; color:white }
    .footer{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:16px;flex-wrap:wrap;color:var(--muted);font-size:12px}
    .badge-pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;font-size:12px;background:#0b0f1a;border:1px solid #1a2340;border-radius:999px}

    /* Tableau des prix */
    .table-wrap{border:1px dashed #223054;border-radius:16px;background:#0a0f18;overflow:hidden}
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{
      text-align:left;font-size:12px;color:#9fb4ff;padding:12px;border-bottom:1px solid #1a2340;background:rgba(18,24,40,.35);
      position:sticky;top:0;backdrop-filter:saturate(1.2) blur(6px);
    }
    tbody td{padding:12px;border-bottom:1px solid #11162a;font-size:14px}
    tbody tr:last-child td{border-bottom:none}
    .right{text-align:right}
    .muted{color:#9aa7c8}
    .ok{color:#69f5ff}
    .warn{color:#f6d38a}
    .err{color:#ff8a8a}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid #1a2340;background:#0b0f1a;font-size:11px}

    .progress{ width:64px;height:64px;border-radius:999px; background:radial-gradient(circle at 30% 30%, rgba(47,227,255,.25), rgba(27,76,255,.15));
      display:grid;place-items:center;position:absolute;bottom:16px;right:16px; box-shadow:0 10px 28px rgba(0,0,0,.45), inset 0 2px 8px rgba(255,255,255,.06) }
    .progress .ring{ width:48px;height:48px;border-radius:999px;border:3px solid rgba(255,255,255,.12); border-right-color:rgba(47,227,255,.9); animation:spin 1s linear infinite }
    @keyframes spin{ to{ transform:rotate(360deg) } }
    .hidden{display:none !important}
  </style>
</head>
<body>
  <div class="container">
    <div class="nav">
      <div class="brand"><div class="logo">∞</div> Infinie & gratuit</div>
      <span class="badge">Convertisseur Crypto ↔ EUR — gratuit</span>
    </div>

    <h1 class="title">Convertisseur Crypto ↔ EUR</h1>
    <p class="small">Cours live via Coinbase (fallback CoinPaprika, secours ≈ J-1 fawaz). Vos données restent locales.</p>

    <div class="grid">
      <!-- PANEL GAUCHE : TABLEAU DES COURS -->
      <div class="panel" id="panel-prices">
        <div class="table-wrap" style="aspect-ratio:16/10;overflow:auto">
          <table id="priceTable">
            <thead>
              <tr>
                <th>Actif</th>
                <th>Symbole</th>
                <th class="right">Prix (EUR)</th>
                <th class="right">1 EUR →</th>
                <th>Source</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div class="footer">
          <div class="badge-pill">
            <span id="modeDot" style="width:8px;height:8px;border-radius:99px;background:#3a3f54"></span>
            <span id="modeText">Initialisation…</span>
          </div>
          <div id="lastUpdate" class="small">—</div>
        </div>

        <div class="progress hidden" id="busy"><div class="ring"></div></div>
        <div class="small" style="margin-top:8px">Transparence : badge “≈ J-1” si la source live est indisponible.</div>
      </div>

      <!-- PANEL DROIT : CONVERTISSEUR -->
      <div class="panel">
        <div class="field">
          <label>Montant</label>
          <input class="input" id="amount" type="number" step="any" min="0" value="1"/>
        </div>

        <div class="field">
          <label>De</label>
          <select class="input" id="fromSel"></select>
        </div>

        <div class="field">
          <label>Vers</label>
          <div class="toolbar">
            <select class="input" id="toSel" style="flex:1"></select>
            <button class="btn" id="swapBtn" title="Inverser">⇄</button>
          </div>
        </div>

        <div class="field">
          <label>Résultat</label>
          <div class="toolbar">
            <input class="input" id="result" type="text" readonly/>
            <button class="btn primary" id="copyBtn">Copier</button>
          </div>
        </div>

        <div class="field">
          <label>Mise à jour</label>
          <div class="toolbar">
            <button class="btn" id="refreshBtn">Rafraîchir</button>
            <select class="input" id="refreshSel" style="max-width:210px">
              <option value="0">Manuel</option>
              <option value="30" selected>Auto — 30 s</option>
              <option value="60">Auto — 60 s</option>
            </select>
          </div>
        </div>

        <p class="small" style="margin-top:10px">
          * Les prix proviennent en priorité de Coinbase. Si l’actif n’est pas listé, on tente CoinPaprika, sinon un
          secours quotidien (≈ J-1).
        </p>
      </div>
    </div>
  </div>

<script>
/* ========= CONFIG ========= */
const EURO_TZ = 'Europe/Paris';
const TTL_SECONDS = 30; // cache local

// 41 actifs : tes 11 + 30 nouveaux
const ASSETS = [
  // Fiat pivot
  { key:'eur',  name:'Euro',            symbol:'EUR' },

  // Tes 11 existantes
  { key:'btc',  name:'Bitcoin',         symbol:'BTC', paprika:'btc-bitcoin',           fawaz:'btc'  },
  { key:'eth',  name:'Ethereum',        symbol:'ETH', paprika:'eth-ethereum',          fawaz:'eth'  },
  { key:'osmosis', name:'Osmosis',      symbol:'OSMO',paprika:'osmo-osmosis',          fawaz:'osmo' },
  { key:'cosmos',  name:'Cosmos',       symbol:'ATOM',paprika:'atom-cosmos',           fawaz:'atom' },
  { key:'cestia',  name:'Celestia',     symbol:'TIA', paprika:'tia-celestia',          fawaz:'tia'  }, // “cestia” → Celestia (TIA)
  { key:'shib',  name:'Shiba Inu',      symbol:'SHIB',paprika:'shib-shiba-inu',        fawaz:'shib' },
  { key:'pepe',  name:'Pepe',           symbol:'PEPE',paprika:'pepe-pepe',             fawaz:'pepe' },
  { key:'sol',   name:'Solana',         symbol:'SOL', paprika:'sol-solana',            fawaz:'sol'  },
  { key:'loka',  name:'League of Kingdoms', symbol:'LOKA', paprika:'loka-league-of-kingdoms-arena', fawaz:'loka' },
  { key:'axis',  name:'Axie Infinity',  symbol:'AXS', paprika:'axs-axie-infinity',     fawaz:'axs'  }, // “axis” → AXS
  { key:'ksm',   name:'Kusama',         symbol:'KSM', paprika:'ksm-kusama',            fawaz:'ksm'  },

  // +30 nouvelles (sélection Coinbase avec fallbacks)
  { key:'ada',  name:'Cardano',             symbol:'ADA',  paprika:'ada-cardano',                 fawaz:'ada'  },
  { key:'xrp',  name:'XRP',                 symbol:'XRP',  paprika:'xrp-xrp',                     fawaz:'xrp'  },
  { key:'doge', name:'Dogecoin',            symbol:'DOGE', paprika:'doge-dogecoin',               fawaz:'doge' },
  { key:'ltc',  name:'Litecoin',            symbol:'LTC',  paprika:'ltc-litecoin',                fawaz:'ltc'  },
  { key:'bch',  name:'Bitcoin Cash',        symbol:'BCH',  paprika:'bch-bitcoin-cash',            fawaz:'bch'  },
  { key:'dot',  name:'Polkadot',            symbol:'DOT',  paprika:'dot-polkadot',                fawaz:'dot'  },
  { key:'matic',name:'Polygon',             symbol:'MATIC',paprika:'matic-polygon',               fawaz:'matic'},
  { key:'avax', name:'Avalanche',           symbol:'AVAX', paprika:'avax-avalanche',              fawaz:'avax' },
  { key:'link', name:'Chainlink',           symbol:'LINK', paprika:'link-chainlink',              fawaz:'link' },
  { key:'apt',  name:'Aptos',               symbol:'APT',  paprika:'apt-aptos',                   fawaz:'apt'  },
  { key:'arb',  name:'Arbitrum',            symbol:'ARB',  paprika:'arb-arbitrum',                fawaz:'arb'  },
  { key:'op',   name:'Optimism',            symbol:'OP',   paprika:'op-optimism',                 fawaz:'op'   },
  { key:'sui',  name:'Sui',                 symbol:'SUI',  paprika:'sui-sui',                     fawaz:'sui'  },
  { key:'icp',  name:'Internet Computer',   symbol:'ICP',  paprika:'icp-internet-computer',       fawaz:'icp'  },
  { key:'near', name:'NEAR Protocol',       symbol:'NEAR', paprika:'near-near-protocol',          fawaz:'near' },
  { key:'algo', name:'Algorand',            symbol:'ALGO', paprika:'algo-algorand',               fawaz:'algo' },
  { key:'fil',  name:'Filecoin',            symbol:'FIL',  paprika:'fil-filecoin',                fawaz:'fil'  },
  { key:'etc',  name:'Ethereum Classic',    symbol:'ETC',  paprika:'etc-ethereum-classic',        fawaz:'etc'  },
  { key:'stx',  name:'Stacks',              symbol:'STX',  paprika:'stx-stacks',                  fawaz:'stx'  },
  { key:'xlm',  name:'Stellar',             symbol:'XLM',  paprika:'xlm-stellar',                 fawaz:'xlm'  },
  { key:'xtz',  name:'Tezos',               symbol:'XTZ',  paprika:'xtz-tezos',                   fawaz:'xtz'  },
  { key:'hbar', name:'Hedera',              symbol:'HBAR', paprika:'hbar-hedera-hashgraph',       fawaz:'hbar' },
  { key:'imx',  name:'Immutable',           symbol:'IMX',  paprika:'imx-immutable-x',             fawaz:'imx'  },
  { key:'inj',  name:'Injective',           symbol:'INJ',  paprika:'inj-injective',               fawaz:'inj'  },
  { key:'rune', name:'THORChain',           symbol:'RUNE', paprika:'rune-thorchain',              fawaz:'rune' },
  { key:'ldo',  name:'Lido DAO',            symbol:'LDO',  paprika:'ldo-lido-dao',                fawaz:'ldo'  },
  { key:'aave', name:'Aave',                symbol:'AAVE', paprika:'aave-aave',                   fawaz:'aave' },
  { key:'mkr',  name:'Maker',               symbol:'MKR',  paprika:'mkr-maker',                   fawaz:'mkr'  },
  { key:'grt',  name:'The Graph',           symbol:'GRT',  paprika:'grt-the-graph',               fawaz:'grt'  },
  { key:'sand', name:'The Sandbox',         symbol:'SAND', paprika:'sand-the-sandbox',            fawaz:'sand' },
];

const SHOW_KEYS = [
  // tes 11
  'btc','eth','osmosis','cosmos','cestia','shib','pepe','sol','loka','axis','ksm',
  // +30 nouvelles
  'ada','xrp','doge','ltc','bch','dot','matic','avax','link','apt','arb','op','sui','icp','near','algo',
  'fil','etc','stx','xlm','xtz','hbar','imx','inj','rune','ldo','aave','mkr','grt','sand'
];

// décimales d’affichage
const DECIMALS = {
  EUR:2,
  BTC:8, ETH:6, OSMO:6, ATOM:6, TIA:6, SHIB:8, PEPE:8, SOL:6, LOKA:6, AXS:6, KSM:6,
  ADA:6, XRP:6, DOGE:6, LTC:6, BCH:6, DOT:6, MATIC:6, AVAX:6, LINK:6, APT:6, ARB:6, OP:6, SUI:6,
  ICP:6, NEAR:6, ALGO:6, FIL:6, ETC:6, STX:6, XLM:6, XTZ:6, HBAR:6, IMX:6, INJ:6, RUNE:6,
  LDO:6, AAVE:6, MKR:6, GRT:6, SAND:6
};

/* ========= STATE ========= */
let pricesEUR = {}; // { SYMBOL: { price, source, stale } }
let lastAt = 0;
const busy = document.getElementById('busy');
const tbody = document.getElementById('tbody');
const lastUpdate = document.getElementById('lastUpdate');
const modeText = document.getElementById('modeText');
const modeDot = document.getElementById('modeDot');

const amountInp = document.getElementById('amount');
const fromSel   = document.getElementById('fromSel');
const toSel     = document.getElementById('toSel');
const resultOut = document.getElementById('result');
const copyBtn   = document.getElementById('copyBtn');
const swapBtn   = document.getElementById('swapBtn');
const refreshBtn= document.getElementById('refreshBtn');
const refreshSel= document.getElementById('refreshSel');

/* ========= UTILS ========= */
const fmt = (n, sym) => {
  if (!isFinite(n)) return '—';
  const d = DECIMALS[sym] ?? 6;
  return n.toLocaleString('fr-FR', { minimumFractionDigits: Math.min(d, 8), maximumFractionDigits: Math.min(d, 8) });
};
const nowStr = () => new Date().toLocaleString('fr-FR',{ timeZone: EURO_TZ, hour12:false });
const setBusy = v => busy.classList.toggle('hidden', !v);
const setOk = txt => { modeText.textContent = txt; modeDot.style.background='linear-gradient(90deg, var(--accent1), var(--accent2))'; };
const setWarn = txt => { modeText.textContent = txt; modeDot.style.background='#b38b3a'; };
const setErr = txt => { modeText.textContent = '⚠️ '+txt; modeDot.style.background='#9b2c2c'; };

function saveCache(){
  try{ localStorage.setItem('crypto_eur_cache_v1', JSON.stringify({ pricesEUR, lastAt: Date.now() })); }catch{}
}
function loadCache(){
  try{
    const raw = localStorage.getItem('crypto_eur_cache_v1');
    if(!raw) return false;
    const { pricesEUR: p, lastAt: t } = JSON.parse(raw);
    if(!p || !t) return false;
    const age = (Date.now()-t)/1000;
    if(age <= TTL_SECONDS*2){ pricesEUR=p; lastAt=t; return true; }
  }catch{}
  return false;
}

/* ========= DATA SOURCES ========= */
// 1) Coinbase snapshot : EUR → map(SYMBOL per EUR). Prix EUR = 1 / rate
async function fetchCoinbaseSnapshot(){
  const r = await fetch('https://api.coinbase.com/v2/exchange-rates?currency=EUR', { cache: 'no-store' });
  if(!r.ok) throw new Error('Coinbase snapshot indisponible');
  const j = await r.json();
  return j?.data?.rates || {};
}
// 1b) Coinbase spot par paire
async function fetchCoinbaseSpot(symbol){
  const r = await fetch(`https://api.coinbase.com/v2/prices/${symbol}-EUR/spot`, { cache: 'no-store' });
  if(!r.ok) throw new Error('Spot pair introuvable');
  const amt = parseFloat((await r.json())?.data?.amount);
  if(!isFinite(amt)) throw new Error('Réponse spot invalide');
  return amt; // EUR
}
// 2) CoinPaprika (EUR direct)
async function fetchPaprikaEUR(coinId){
  const r = await fetch(`https://api.coinpaprika.com/v1/tickers/${coinId}?quotes=EUR`, { cache:'no-store' });
  if(!r.ok) throw new Error('Paprika KO');
  const price = (await r.json())?.quotes?.EUR?.price;
  if(!isFinite(price)) throw new Error('Paprika invalide');
  return price;
}
// 3) Fawaz (≈ J-1) : EUR → { btc: x, eth: y, ... } ; prix EUR = 1/x
let fawazCache=null;
async function fetchFawazEUR(){
  if(fawazCache) return fawazCache;
  const r = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/exchange-api@latest/v1/currencies/eur.json', { cache:'no-store' });
  if(!r.ok) throw new Error('Fawaz KO');
  fawazCache = (await r.json())?.eur || {};
  return fawazCache;
}

/* ========= AGGREGATE ========= */
async function refreshAll(){
  try{
    setBusy(true); setOk('Récupération des cours…');
    // 1) Coinbase snapshot
    let snapshot={};
    try { snapshot = await fetchCoinbaseSnapshot(); }
    catch { setWarn('Coinbase lent… (on tente d’autres sources)'); }

    // 2) Pour chaque coin → snapshot → spot → paprika → fawaz
    pricesEUR = {};
    for(const a of ASSETS){
      if(a.symbol==='EUR') { pricesEUR['EUR'] = { price: 1, source:'ref', stale:false }; continue; }

      let done=false;

      // snapshot
      if(snapshot && snapshot[a.symbol]){
        const perCoin = parseFloat(snapshot[a.symbol]); // coin per 1 EUR
        if(perCoin>0){ pricesEUR[a.symbol] = { price: 1/perCoin, source:'coinbase', stale:false }; done=true; }
      }

      // spot
      if(!done){
        try{
          const spot = await fetchCoinbaseSpot(a.symbol);
          pricesEUR[a.symbol] = { price: spot, source:'coinbase', stale:false }; done=true;
        }catch{/* ignore */}
      }

      // paprika
      if(!done && a.paprika){
        try{
          const px = await fetchPaprikaEUR(a.paprika);
          pricesEUR[a.symbol] = { price: px, source:'paprika', stale:false }; done=true;
        }catch{/* ignore */}
      }

      // fawaz (≈ J-1) — utilise code dédié ou le symbole par défaut
      if(!done){
        try{
          const eurMap = await fetchFawazEUR();
          const code = (a.fawaz || a.symbol).toLowerCase();
          if(eurMap[code]>0){
            pricesEUR[a.symbol] = { price: 1/parseFloat(eurMap[code]), source:'fawaz≈J-1', stale:true };
            done=true;
          }
        }catch{/* ignore */}
      }

      if(!done){
        pricesEUR[a.symbol] = { price: NaN, source:'indispo', stale:true };
      }
    }

    lastAt = Date.now();
    paintTable();
    lastUpdate.textContent = 'MAJ : ' + nowStr();
    saveCache();
    setOk('Cours prêts');
  }catch(e){
    console.error(e); setErr(e?.message||'Erreur réseau');
  }finally{
    setBusy(false);
    computeResult();
  }
}

/* ========= UI PAINT ========= */
function paintTable(){
  const rows=[];
  for(const key of SHOW_KEYS){
    const a = ASSETS.find(x=>x.key===key);
    const info = pricesEUR[a.symbol]||{};
    const ok = isFinite(info.price);
    const oneEur = ok ? 1/info.price : NaN;
    const cls = !ok ? 'err' : (info.stale?'warn':'ok');
    const source = info.source||'—';
    rows.push(`
      <tr>
        <td>${a.name}</td>
        <td class="muted">${a.symbol}</td>
        <td class="right ${cls}">${ ok ? fmt(info.price,'EUR') : '—' }</td>
        <td class="right ${cls}">${ ok ? fmt(oneEur,a.symbol)+' '+a.symbol : '—' }</td>
        <td><span class="pill">${source}</span></td>
      </tr>
    `);
  }
  tbody.innerHTML = rows.join('');
}

/* ========= CONVERTER ========= */
function buildSelectors(){
  const opts = ASSETS.filter(a=>a.symbol==='EUR' || SHOW_KEYS.includes(a.key))
    .map(a=> `<option value="${a.symbol}">${a.symbol} — ${a.name}</option>`).join('');
  fromSel.innerHTML = opts;
  toSel.innerHTML = opts;
  fromSel.value = 'EUR';
  toSel.value = 'BTC';
}
function computeResult(){
  const amt = parseFloat(amountInp.value||'0');
  const from = fromSel.value;
  const to   = toSel.value;
  if(!isFinite(amt)){ resultOut.value=''; return; }
  if(from === to){ resultOut.value = fmt(amt, to); return; }
  const pFrom = pricesEUR[from]?.price;
  const pTo   = pricesEUR[to]?.price;
  if(!isFinite(pFrom) || !isFinite(pTo)){ resultOut.value='—'; return; }
  // conversion via EUR pivot
  const eurAmount = (from==='EUR') ? amt : (amt * pFrom); // coin→EUR
  const out = (to==='EUR') ? eurAmount : (eurAmount / pTo);
  resultOut.value = fmt(out, to);
}

/* ========= EVENTS ========= */
amountInp.addEventListener('input', computeResult);
[fromSel, toSel].forEach(s=> s.addEventListener('change', computeResult));
swapBtn.addEventListener('click', ()=>{
  const a = fromSel.value; fromSel.value = toSel.value; toSel.value = a; computeResult();
});
copyBtn.addEventListener('click', ()=>{
  navigator.clipboard?.writeText(resultOut.value||''); copyBtn.textContent='Copié !';
  setTimeout(()=>copyBtn.textContent='Copier',900);
});
refreshBtn.addEventListener('click', refreshAll);
refreshSel.addEventListener('change', restartAuto);

let autoTimer=null;
function restartAuto(){
  if(autoTimer) clearInterval(autoTimer), autoTimer=null;
  const sec = parseInt(refreshSel.value,10)||0;
  if(sec>0) autoTimer = setInterval(()=> refreshAll(), sec*1000);
}

/* ========= INIT ========= */
(function init(){
  buildSelectors();
  if(loadCache()){ paintTable(); computeResult(); lastUpdate.textContent='Cache récent • ' + nowStr(); }
  refreshAll();
  restartAuto();
})();
</script>
</body>
</html>
