<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Infinie & gratuit — Formation Staking + Simulateur (Revolut)</title>
<meta name="color-scheme" content="dark"/>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0B0B0D; --panel:#0d1120; --text:#E6ECF7; --muted:#A4ADBD;
  --border:rgba(95,123,255,0.18); --accent1:#2FE3FF; --accent2:#1B4CFF; --ring:0 0 0 2px rgba(43,167,255,.35);
  --good:#33d69f; --warn:#ffd465; --bad:#ff6b6b;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:
    radial-gradient(1200px 600px at 8% 12%, rgba(43,167,255,0.12), transparent 60%),
    radial-gradient(1000px 800px at 82% 85%, rgba(27,76,255,0.10), transparent 55%),
    var(--bg);
  color:var(--text);
}

/* Top bar */
.nav{
  position:sticky; top:16px; margin:16px; z-index:30;
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:12px 14px; background:
    linear-gradient(160deg, rgba(27,76,255,0.06), transparent),
    linear-gradient(180deg, rgba(47,227,255,0.05), transparent 40%), var(--panel);
  border:1px solid var(--border); border-radius:14px;
  box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
}
.brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
.logo{width:28px;height:28px;border-radius:999px;background:radial-gradient(circle at 30% 30%,var(--accent1),var(--accent2));display:grid;place-items:center;color:#fff;font-weight:800}
.tabs{display:flex; gap:8px; background:#0b0f1a; border:1px solid #1a2340; padding:6px; border-radius:12px}
.tab{border:none; background:transparent; color:var(--text); font-weight:700; padding:8px 12px; border-radius:10px; cursor:pointer}
.tab.active{background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#fff}
.container{ display:grid; grid-template-columns: 1fr; gap:16px; padding:0 16px 120px; }

/* Cards */
.card{
  background:
    linear-gradient(160deg, rgba(27,76,255,0.06), transparent),
    linear-gradient(180deg, rgba(47,227,255,0.05), transparent 40%), var(--panel);
  border:1px solid var(--border); border-radius:16px; padding:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
}

/* Icons */
.icon{width:18px;height:18px;vertical-align:-3px}
.ic24{width:24px;height:24px}
.ico{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:10px;background:#0b0f1a;border:1px solid #1a2340}

/* Views */
.view{display:none; opacity:0; transform:translateY(6px); transition:.25s ease}
.view.active{display:block; opacity:1; transform:none}

/* Lessons */
.lesson-header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px}
.progress{height:8px; background:#0b0f1a; border:1px solid #1a2340; border-radius:999px; overflow:hidden}
.progress > div{height:100%; background:linear-gradient(90deg, var(--accent1), var(--accent2)); width:0%}
.lesson-body{display:grid; grid-template-columns: 1fr 340px; gap:16px}
@media (max-width: 980px){ .lesson-body{grid-template-columns: 1fr} }
.lesson-main{padding:16px; border:1px solid #1a2340; border-radius:12px; background:#0b0f1a}
.lesson-main h3{margin:0 0 6px}
.lesson-main h4{margin:12px 0 6px}
.lesson-aside{display:grid; gap:10px}
.fact{padding:12px; border:1px solid #1a2340; border-radius:12px; background:#0b0f1a}
.fact strong{display:block; margin-bottom:6px}
.lesson-nav{display:flex; gap:8px; justify-content:space-between; margin-top:12px}
.btn{
  background:#0b0f1a;border:1px solid #1a2340;color:var(--text);
  border-radius:10px;padding:10px 12px;font-size:13px;cursor:pointer;font-weight:700;display:inline-flex;align-items:center;gap:8px
}
.btn:hover{ box-shadow:var(--ring); border-color:#3a63ff }
.btn.primary{ background: linear-gradient(90deg, var(--accent1), var(--accent2)); border:none; color:white }
.btn.ghost{ background:transparent;border-color:var(--border) }
.small{font-size:12px;color:var(--muted)}

/* Simulator */
.sim-wrap{display:grid; gap:14px}
.inputs{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px}
@media (max-width: 1200px){ .inputs{grid-template-columns: 1fr} }
.input{
  display:flex; align-items:center; gap:10px; background:#0b0f1a; border:1px solid #1a2340; border-radius:12px; padding:10px 12px;
}
.input input, .input select{
  flex:1; background:transparent; border:none; outline:none; color:var(--text); font:inherit; font-weight:700;
}
.input .unit{opacity:.8; font-weight:700}
.lock{opacity:.8; pointer-events:none}
.table{overflow:auto; border:1px solid #1a2340; border-radius:12px; background:#0b0f1a}
table{ width:100%; border-collapse:separate; border-spacing:0 }
th,td{ padding:12px 10px; border-bottom:1px solid #131a2b; text-align:left; white-space:nowrap }
th{ position:sticky; top:0; background:#0c1120; font-weight:800 }
tr:last-child td{ border-bottom:none }
.good{color:var(--good)}

.chart-card{padding:16px;border:1px solid #1a2340;border-radius:12px;background:#0b0f1a}
canvas{width:100%;height:320px;display:block}

/* Support block (CTA) */
.support{
  position:fixed; left:0; right:0; bottom:0; padding:20px 16px;
  background:linear-gradient(180deg, rgba(13,17,32,.0), rgba(13,17,32,.78));
}
.support .card{
  width:min(980px,100%); margin:0 auto; display:grid; grid-template-columns:1.2fr .8fr; gap:18px; align-items:center;
  background:linear-gradient(180deg, rgba(13,17,32,.66), rgba(13,17,32,.92));
  border:1px solid var(--border); border-radius:20px; padding:22px;
}
@media (max-width:820px){ .support .card{grid-template-columns:1fr} }
.btn-big{
  appearance:none; border:0; background:linear-gradient(135deg,var(--accent1),var(--accent2));
  color:#0B0B0D; font-weight:800; padding:16px 18px; border-radius:14px; cursor:pointer;
  text-align:center; text-decoration:none; font-size:16px; box-shadow:0 6px 22px rgba(47,227,255,.22);
}
.alt{display:flex; gap:10px; flex-wrap:wrap; align-items:center; color:var(--muted); font-size:14px}
.alt a{color:var(--accent1); text-decoration:none; border-bottom:1px dotted rgba(47,227,255,.4)}
.qr{justify-self:end; background:#0c1020; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:10px}
.qr img{width:140px; height:140px; display:block}

/* Disclaimer */
.disclaimer{font-size:12px;color:var(--muted);border:1px dashed #223;border-radius:10px;padding:10px;margin-top:8px}
</style>
</head>
<body>
  <!-- SVG ICONS -->
  <svg width="0" height="0" style="position:absolute;visibility:hidden">
    <symbol id="i-lesson" viewBox="0 0 24 24"><path fill="#2FE3FF" d="M4 5a2 2 0 0 1 2-2h12a1 1 0 0 1 1 1v15.5a.5.5 0 0 1-.76.43L12 16.5 5.76 19.93A.5.5 0 0 1 5 19.5V5Z"/></symbol>
    <symbol id="i-sim" viewBox="0 0 24 24"><path fill="#1B4CFF" d="M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14H3V5Z"/><path fill="#2FE3FF" d="M7 9h4v2H7V9Zm0 4h10v2H7v-2Z"/></symbol>
    <symbol id="i-prev" viewBox="0 0 24 24"><path fill="#9fb4ff" d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></symbol>
    <symbol id="i-next" viewBox="0 0 24 24"><path fill="#9fb4ff" d="M8.59 16.59 10 18l6-6-6-6-1.41 1.41L12.17 12z"/></symbol>
    <symbol id="i-sync" viewBox="0 0 24 24"><path fill="#2FE3FF" d="M12 6V3L8 7l4 4V8c2.21 0 4 1.79 4 4 0 .65-.15 1.27-.42 1.82l1.46 1.46A6 6 0 0 0 12 6Zm-4 6c0-.65.15-1.27.42-1.82L6 8.72A6 6 0 0 0 12 18v3l4-4-4-4v3a4 4 0 0 1-4-4Z"/></symbol>
    <symbol id="i-euro" viewBox="0 0 24 24"><path fill="#2FE3FF" d="M15.5 5.5a6.5 6.5 0 1 0 0 13h.5v-2h-.5a4.5 4.5 0 1 1 0-9h.5v-2h-.5Z"/><path fill="#1B4CFF" d="M6 11h8v2H6z"/></symbol>
    <symbol id="i-apy" viewBox="0 0 24 24"><path fill="#33d69f" d="M4 19V5h2v12h12v2H4Z"/><path fill="#2FE3FF" d="M8 13l3-3 2 2 4-4 1.5 1.5-5.5 5.5-2-2-2 2z"/></symbol>
    <symbol id="i-price" viewBox="0 0 24 24"><path fill="#ffd465" d="M11 3h2v18h-2z"/><circle cx="12" cy="7" r="3" fill="#2FE3FF"/></symbol>
    <symbol id="i-info" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#1B4CFF"/><rect x="11" y="10" width="2" height="7" fill="#fff"/><rect x="11" y="7" width="2" height="2" fill="#fff"/></symbol>
    <symbol id="i-check" viewBox="0 0 24 24"><path fill="#33d69f" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></symbol>
    <symbol id="i-warn" viewBox="0 0 24 24"><path fill="#ffd465" d="M1 21h22L12 2 1 21zm12-3h-2v2h2v-2zm0-8h-2v6h2v-6z"/></symbol>
    <symbol id="i-chart" viewBox="0 0 24 24"><path fill="#2FE3FF" d="M3 19h18v2H3z"/><rect x="5" y="11" width="3" height="6" fill="#1B4CFF"/><rect x="10.5" y="8" width="3" height="9" fill="#33d69f"/><rect x="16" y="5" width="3" height="12" fill="#ffd465"/></symbol>
  </svg>

  <!-- Top bar -->
  <header class="nav">
    <div class="brand"><div class="logo">∞</div> Infinie & gratuit</div>
    <div class="tabs">
      <button class="tab active" id="tabLessons"><svg class="icon"><use href="#i-lesson"/></svg>&nbsp;Leçons</button>
      <button class="tab" id="tabSim"><svg class="icon"><use href="#i-sim"/></svg>&nbsp;Simulateur</button>
    </div>
  </header>

  <main class="container">
    <!-- LEÇONS -->
    <section class="card view active" id="viewLessons">
      <div class="lesson-header">
        <div style="display:flex; align-items:center; gap:10px">
          <div class="ico"><svg class="ic24"><use href="#i-lesson"/></svg></div>
          <div>
            <div style="font-weight:800">Parcours — Comprendre le staking (débutant → avancé)</div>
            <div class="small" id="lessonCounter">Leçon 1 / 12</div>
          </div>
        </div>
        <button class="btn" id="btnGoSimTop"><svg class="icon"><use href="#i-sim"/></svg> Accéder au simulateur</button>
      </div>

      <div class="progress"><div id="progressBar"></div></div>

      <div class="lesson-body" style="margin-top:12px">
        <article class="lesson-main" id="lessonContent"><!-- Injecté --></article>
        <aside class="lesson-aside">
          <div class="fact">
            <strong><svg class="icon"><use href="#i-info"/></svg> À retenir</strong>
            <div class="small" id="tipBox">On part de zéro, sans jargon. Tu peux passer au simulateur à tout moment.</div>
          </div>
          <div class="fact">
            <strong><svg class="icon"><use href="#i-warn"/></svg> Rappel</strong>
            <div class="small">Rien ici n’est un conseil d’investissement. C’est éducatif.</div>
          </div>
        </aside>
      </div>

      <div class="lesson-nav">
        <div>
          <button class="btn" id="btnPrev"><svg class="icon"><use href="#i-prev"/></svg> Précédent</button>
        </div>
        <div style="display:flex; gap:8px">
          <button class="btn ghost" id="btnGoSim"><svg class="icon"><use href="#i-sim"/></svg> Afficher le simulateur</button>
          <button class="btn primary" id="btnNext">Suivant <svg class="icon"><use href="#i-next"/></svg></button>
        </div>
      </div>
    </section>

    <!-- RÉSULTATS QUIZ -->
    <section class="card view" id="viewResults">
      <div class="lesson-header">
        <div style="display:flex; align-items:center; gap:10px">
          <div class="ico"><svg class="ic24"><use href="#i-check"/></svg></div>
          <div>
            <div style="font-weight:800">Résultats du quiz</div>
            <div class="small">Bravo pour avoir terminé le parcours !</div>
          </div>
        </div>
      </div>
      <div class="lesson-main">
        <h3 id="scoreTitle">Score : — / —</h3>
        <p id="scoreAdvice" class="small">Analyse de tes réponses, points à revoir et prochaines étapes.</p>
        <div style="display:flex; gap:8px; margin-top:8px">
          <button class="btn primary" id="resGoSim"><svg class="icon"><use href="#i-sim"/></svg> Afficher le simulateur</button>
          <button class="btn" id="resRestart"><svg class="icon"><use href="#i-prev"/></svg> Recommencer les leçons</button>
        </div>
      </div>
    </section>

    <!-- SIMULATEUR -->
    <section class="card view" id="viewSim">
      <div class="lesson-header">
        <div style="display:flex; align-items:center; gap:10px">
          <div class="ico"><svg class="ic24"><use href="#i-sim"/></svg></div>
          <div>
            <div style="font-weight:800">Simulateur de Staking (APY Revolut — non modifiable)</div>
            <div class="small">Prix EUR : CoinGecko • APY : d’après tes captures (“jusqu’à”).</div>
          </div>
        </div>
        <div style="display:flex; gap:8px">
          <button class="btn" id="syncBtn"><svg class="icon"><use href="#i-sync"/></svg> Synchroniser</button>
          <button class="btn" id="btnBackToLessons"><svg class="icon"><use href="#i-lesson"/></svg> Retour aux leçons</button>
        </div>
      </div>

      <div class="sim-wrap">
        <!-- 1) ENTRÉES -->
        <div class="inputs">
          <div class="input" title="Crypto (APY verrouillé)">
            <svg class="icon"><use href="#i-price"/></svg>
            <select id="tokenSelect"></select>
          </div>
          <div class="input" title="Montant en euros">
            <svg class="icon"><use href="#i-euro"/></svg>
            <input id="eurInput" type="number" min="0" step="0.01" placeholder="Montant en EUR (ex : 1000)"/>
            <span class="unit">EUR</span>
          </div>
          <div class="input lock" title="APY (Revolut)">
            <svg class="icon"><use href="#i-apy"/></svg>
            <input id="apyInput" type="text" value="—" disabled/>
            <span class="unit">%</span>
          </div>
        </div>

        <!-- Infos prix / conversion -->
        <div class="inputs">
          <div class="input" title="Montant en token">
            <svg class="icon"><use href="#i-price"/></svg>
            <input id="tokenAmount" type="number" min="0" step="0.00000001" placeholder="Montant en token"/>
            <span class="unit" id="tokenUnit">—</span>
          </div>
          <div class="input" title="Prix actuel">
            <svg class="icon"><use href="#i-info"/></svg>
            <input id="priceNow" type="text" disabled value="—"/>
            <span class="unit">€/token</span>
          </div>
          <div class="input" title="Dernière synchro">
            <svg class="icon"><use href="#i-sync"/></svg>
            <input id="lastUpdate" type="text" disabled value="—"/>
          </div>
        </div>

        <!-- 2) TABLEAU DES RENDEMENTS -->
        <div class="table">
          <table>
            <thead>
              <tr>
                <th>Période</th>
                <th>Gain (token)</th>
                <th>Gain (€)</th>
                <th>Total (€) estimé</th>
              </tr>
            </thead>
            <tbody id="yieldTable"></tbody>
          </table>
        </div>

        <!-- 3) COURBE 10 ANS -->
        <div class="chart-card">
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px">
            <svg class="icon"><use href="#i-chart"/></svg>
            <strong>Projection 10 ans (composition mensuelle, prix constant)</strong>
          </div>
          <canvas id="chart" width="900" height="320" aria-label="Projection 10 ans"></canvas>
        </div>

        <!-- 4) DISCLAIMER -->
        <div class="disclaimer">
          Cet outil est éducatif et <b>ne constitue pas</b> un conseil financier. Les rendements “jusqu’à” sont ceux affichés dans Revolut (susceptibles d’évoluer). 
          Le prix des crypto-actifs est volatil, et des risques existent (frais, unbonding, slashing, garde).
        </div>
      </div>
    </section>
  </main>

  <!-- SUPPORT / REVOLUT -->
  <section class="support">
    <div class="card">
      <div>
        <h2 style="margin:0 0 6px">Soutenir le site via Revolut</h2>
        <p class="small" style="margin:0 0 12px">Scanne le QR ou clique sur le bouton pour ouvrir mon lien Revolut. Merci pour le soutien ❤️</p>
        <div style="display:flex; gap:12px; flex-wrap:wrap">
          <!-- TODO: remplace le lien ci-dessous par ton vrai lien Revolut -->
          <a class="btn-big" href="https://revolut.com/referral/?referral-code=oscarn60z!OCT1-25-AR-H1&geo-redirect" target="_blank" rel="noopener">Ouvrir mon lien Revolut</a>
          <div class="alt"><span>Ou scanne →</span></div>
        </div>
      </div>
      <div class="qr"><img src="revolut_qr.png" alt="QR code Revolut"></div>
    </div>
  </section>

<script>
/* --------------------------- LEÇONS (10 vraies + quiz + résultats) --------------------------- */
const lessons = [
  { title: "Découvrir Revolut (zéro jargon)", html: `
      <h4>Objectif</h4>
      <p>Comprendre ce qu'est <b>Revolut</b> et où trouver la partie crypto.</p>
      <h4>Dans l'app</h4>
      <ol>
        <li>Ouvre l’onglet <b>Invest/Crypto</b>.</li>
        <li>Parcours la liste des actifs, observe l’étiquette <b>“Gagner”</b> (staking).</li>
        <li>Lis toujours <b>frais</b> et <b>conditions</b> avant d’agir.</li>
      </ol>` },
  { title: "Actif numérique & custody", html: `
      <p>Un actif vit sur une blockchain. En custodial (plateforme), c’est l’intermédiaire qui gère la garde ; en non-custodial (wallet), c’est toi.</p>` },
  { title: "Proof-of-Stake en 2 minutes", html: `
      <p>Des <b>validateurs</b> sécurisent le réseau PoS. Les détenteurs délèguent leurs tokens pour aider et recevoir des récompenses.</p>` },
  { title: "Staking : délégation & rendement", html: `
      <p>Tu délègues sans céder la propriété. En échange, tu touches un rendement annuel (<b>APR/APY</b>).</p>` },
  { title: "APR vs APY (simple vs composé)", html: `
      <ul><li><b>APR</b> = taux simple.</li><li><b>APY</b> = taux <b>composé</b> (réinvesti).</li></ul>
      <p>Notre simulateur utilise une approximation composée pour lisser les périodes.</p>` },
  { title: "Versements & unbonding", html: `
      <p>Les récompenses arrivent souvent par <b>epochs</b> (quelques jours). L’<b>unbonding</b> est un délai avant de récupérer tes fonds après unstake.</p>` },
  { title: "Frais → rendement net", html: `
      <p>Sur Revolut comme ailleurs, le net dépend des commissions, frais de réseau, et fiscalité.</p>` },
  { title: "Risques essentiels", html: `
      <ul><li><b>Garde</b> (custody),</li><li><b>Slashing</b> (pénalité d’un validateur),</li><li><b>Volatilité</b> du prix,</li><li><b>Unbonding</b> (immobilisation temporaire).</li></ul>` },
  { title: "Pas-à-pas dans Revolut", html: `
      <ol><li>Choisis un actif affiché “Gagner”.</li><li>Lis le <b>taux</b> “jusqu’à … % APY”.</li><li>Teste avec un petit montant, note date/taux/frais.</li></ol>` },
  { title: "Bonnes pratiques & fiscalité", html: `
      <ul><li>Commence petit, diversifie.</li><li>Garde un coussin de liquidité.</li><li>Renseigne-toi sur la fiscalité locale.</li></ul>` },
  { title: "Quiz (5 questions)", html: `
      <div class="quiz-q" data-q="0">
        <h4>Sur Revolut, la garde est…</h4>
        <label><input type="radio" name="q0" value="a"> Non-custodial</label>
        <label><input type="radio" name="q0" value="b"> Custodial</label>
      </div>
      <div class="quiz-q" data-q="1">
        <h4>L’APY intègre…</h4>
        <label><input type="radio" name="q1" value="a"> Un taux simple</label>
        <label><input type="radio" name="q1" value="b"> La composition</label>
      </div>
      <div class="quiz-q" data-q="2">
        <h4>L’unbonding implique…</h4>
        <label><input type="radio" name="q2" value="a"> Récupération instantanée</label>
        <label><input type="radio" name="q2" value="b"> Un délai</label>
      </div>
      <div class="quiz-q" data-q="3">
        <h4>Le slashing, c’est…</h4>
        <label><input type="radio" name="q3" value="a"> Une prime au validateur</label>
        <label><input type="radio" name="q3" value="b"> Une pénalité</label>
      </div>
      <div class="quiz-q" data-q="4">
        <h4>Le facteur qui peut faire baisser la valeur en € :</h4>
        <label><input type="radio" name="q4" value="a"> La volatilité du token</label>
        <label><input type="radio" name="q4" value="b"> La couleur de l’app</label>
      </div>
      <div class="lesson-nav" style="justify-content:flex-end; margin-top:6px">
        <button class="btn" id="btnCheckQuiz">Corriger</button>
      </div>
      <div class="quiz-res" id="quizResult"></div>` }
];

const tips = [
  "Revolut : simple d’accès ; lis toujours les conditions.",
  "Custody : qui détient les clés ?",
  "PoS : validateurs + délégation.",
  "APY > APR si réinvesti.",
  "Versements ≠ forcément quotidiens.",
  "Le net = brut – frais – impôts (le cas échéant).",
  "Connais les risques avant d’agir.",
  "Teste avec de petits montants.",
  "Garde une réserve de cash.",
  "Diversifie intelligemment.",
  "Finis par le quiz, puis simule."
];

let step = 0; // 0..10 (11 pages avec quiz) puis page résultats
const $viewLessons = document.getElementById('viewLessons');
const $viewSim = document.getElementById('viewSim');
const $viewResults = document.getElementById('viewResults');
const $tabLessons = document.getElementById('tabLessons');
const $tabSim = document.getElementById('tabSim');
const $lessonContent = document.getElementById('lessonContent');
const $lessonCounter = document.getElementById('lessonCounter');
const $progressBar = document.getElementById('progressBar');
const $tipBox = document.getElementById('tipBox');

function showView(which){
  $viewLessons.classList.remove('active');
  $viewSim.classList.remove('active');
  $viewResults.classList.remove('active');
  $tabLessons.classList.remove('active');
  $tabSim.classList.remove('active');
  if(which==='lessons'){ $viewLessons.classList.add('active'); $tabLessons.classList.add('active'); }
  if(which==='sim'){ $viewSim.classList.add('active'); $tabSim.classList.add('active'); }
  if(which==='results'){ $viewResults.classList.add('active'); $tabLessons.classList.add('active'); }
  window.scrollTo({top:0, behavior:'smooth'});
}
function renderLesson(){
  const cur = lessons[step];
  $lessonContent.innerHTML = `<h3>${cur.title}</h3>${cur.html}`;
  $lessonCounter.textContent = `Leçon ${step+1} / 12`; // 10 leçons + quiz + résultats
  const pct = (step/11)*100; // résultats = 12e
  $progressBar.style.width = `${pct}%`;
  $tipBox.textContent = tips[step] || tips[tips.length-1];

  if(step===lessons.length-1){ // Quiz
    document.getElementById('btnCheckQuiz')?.addEventListener('click', ()=>{
      const answers = ['b','b','b','b','a'];
      let score = 0;
      answers.forEach((ans,i)=>{
        const picked = (document.querySelector(`input[name="q${i}"]:checked`)||{}).value;
        if(picked===ans) score++;
      });
      document.getElementById('scoreTitle').textContent = `Score : ${score} / ${answers.length}`;
      document.getElementById('scoreAdvice').textContent = score===answers.length
        ? "Excellent ! Tu maîtrises les bases. Passe au simulateur pour explorer."
        : "Bien joué ! Revois les points manqués, puis utilise le simulateur pour mieux comprendre.";
      showView('results');
    });
  }
}
function nextLesson(){ if(step < lessons.length-1){ step++; renderLesson(); } else { showView('results'); } }
function prevLesson(){ if(step>0){ step--; renderLesson(); } }
function restartLessons(){ step=0; renderLesson(); showView('lessons'); }
function goSim(){ showView('sim'); }

document.getElementById('btnNext').addEventListener('click', nextLesson);
document.getElementById('btnPrev').addEventListener('click', prevLesson);
document.getElementById('btnGoSim').addEventListener('click', goSim);
document.getElementById('btnGoSimTop').addEventListener('click', goSim);
document.getElementById('btnBackToLessons').addEventListener('click', ()=> showView('lessons'));
document.getElementById('resRestart').addEventListener('click', restartLessons);
document.getElementById('resGoSim').addEventListener('click', goSim);
$tabLessons.addEventListener('click', ()=> showView('lessons'));
$tabSim.addEventListener('click', ()=> showView('sim'));

/* --------------------------- SIMULATEUR --------------------------- */
/* APY verrouillés d’après tes captures Revolut (“jusqu’à … % APY”) */
const TOKENS = [
  {sym:'ATOM', name:'Cosmos',        apy:0.2225, cg:['cosmos-hub']},
  {sym:'TIA',  name:'Celestia',      apy:0.1355, cg:['celestia']},
  {sym:'NEAR', name:'NEAR Protocol', apy:0.1046, cg:['near']},
  {sym:'DOT',  name:'Polkadot',      apy:0.0935, cg:['polkadot']},
  {sym:'OSMO', name:'Osmosis',       apy:0.0714, cg:['osmosis']},
  {sym:'SOL',  name:'Solana',        apy:0.0672, cg:['solana']},
  {sym:'TRX',  name:'Tron',          apy:0.0364, cg:['tron']},
  {sym:'ETH',  name:'Ether',         apy:0.0281, cg:['ethereum']},
  {sym:'POL',  name:'POL (ex-MATIC)',apy:0.0227, cg:['polygon-ecosystem-token','matic-network']}, /* fallback si l’id évolue */
  {sym:'XTZ',  name:'Tezos',         apy:0.0221, cg:['tezos']},
  {sym:'ADA',  name:'Cardano',       apy:0.0201, cg:['cardano']},
];

const S = { selected:'ETH', pricesEUR:{}, lastTs:null };

const $sel = document.getElementById('tokenSelect');
const $eur = document.getElementById('eurInput');
const $apy = document.getElementById('apyInput');
const $tok = document.getElementById('tokenAmount');
const $unit = document.getElementById('tokenUnit');
const $priceNow = document.getElementById('priceNow');
const $lastUpdate = document.getElementById('lastUpdate');
const $tableBody = document.getElementById('yieldTable');
const $canvas = document.getElementById('chart');

TOKENS.forEach(t=> {
  const o = document.createElement('option');
  o.value = t.sym; o.textContent = `${t.sym} — ${t.name} (APY ${ (t.apy*100).toFixed(2) }%)`;
  $sel.appendChild(o);
});
$sel.value = S.selected;

function tokenBySym(sym){ return TOKENS.find(t=>t.sym===sym); }
function fmtFiat(v){ return new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR',maximumFractionDigits:2}).format(v||0); }
function fmtTok(v){ return (v??0).toLocaleString('fr-FR',{maximumFractionDigits:8}); }

// --- remplace TOUT ce bloc (fetchPrices + priceEUR + S.pricesEUR) ---

// Map de prix par symbole (ex: { ETH: 3200.12, SOL: 150.33, ... })
S.pricesEUR = {};

// Prix pour un symbole (ou null)
function priceEUR(sym){
  const v = S.pricesEUR[sym];
  return (typeof v === 'number' && isFinite(v)) ? v : null;
}

// Fetch prix avec fallback: CoinGecko -> CryptoCompare -> Coinbase
async function fetchPrices(){
  const results = {}; // par symbole
  const wantSyms = TOKENS.map(t => t.sym);

  // 1) CoinGecko (multi-ids)
  try{
    const ids = Array.from(new Set(TOKENS.flatMap(t=>t.cg))).join(',');
    const url = `https://api.coingecko.com/api/v3/simple/price?ids=${encodeURIComponent(ids)}&vs_currencies=eur`;
    const r = await fetch(url, {cache:'no-store', mode:'cors', headers:{'Accept':'application/json'}});
    if(r.ok){
      const j = await r.json();
      TOKENS.forEach(t=>{
        for(const id of t.cg){
          const v = j?.[id]?.eur;
          if(typeof v === 'number'){ results[t.sym] = v; break; }
        }
      });
    }
  }catch(e){ /* silence: on passera aux fallbacks */ }

  // 2) CryptoCompare (complète les manquants d'un coup)
  const missing1 = wantSyms.filter(s => results[s]==null);
  if(missing1.length){
    try{
      const url = `https://min-api.cryptocompare.com/data/pricemulti?fsyms=${missing1.join(',')}&tsyms=EUR`;
      const r = await fetch(url, {cache:'no-store', mode:'cors'});
      if(r.ok){
        const j = await r.json();
        missing1.forEach(s => {
          const v = j?.[s]?.EUR;
          if(typeof v === 'number') results[s] = v;
        });
      }
    }catch(e){}
  }

  // 3) Coinbase (par paire, dernier filet de sécurité)
  const missing2 = wantSyms.filter(s => results[s]==null);
  if(missing2.length){
    await Promise.all(missing2.map(async sym => {
      // Coinbase n'a pas (encore) POL: on tente MATIC-EUR comme alias
      const pair = sym==='POL' ? 'MATIC-EUR' : `${sym}-EUR`;
      try{
        const r = await fetch(`https://api.coinbase.com/v2/prices/${pair}/spot`, {cache:'no-store', mode:'cors'});
        if(r.ok){
          const j = await r.json();
          const v = parseFloat(j?.data?.amount);
          if(!Number.isNaN(v)) results[sym] = v;
        }
      }catch(e){}
    }));
  }

  S.pricesEUR = results;
}


function selectToken(sym){
  S.selected = sym; $sel.value = sym; $unit.textContent = sym;
  const t = tokenBySym(sym);
  $apy.value = (t.apy*100).toFixed(2);
  const p = priceEUR(sym); $priceNow.value = (p!=null)? p.toFixed(2) : '—';
  syncTokenFromEUR(); recalcAll();
}
function syncTokenFromEUR(){ const eur = parseFloat($eur.value)||0; const p = priceEUR(S.selected); if(p>0) $tok.value = (eur/p).toFixed(8); }
function syncEURFromToken(){ const tok = parseFloat($tok.value)||0; const p = priceEUR(S.selected); if(p>0) $eur.value = (tok*p).toFixed(2); }

function buildTable(tok, apy, p){
  const daily   = tok * (Math.pow(1+apy, 1/365)-1);
  const monthly = tok * (Math.pow(1+apy, 1/12)-1);
  const yearly  = tok * apy;
  const fiveY   = tok * (Math.pow(1+apy, 5)-1);
  const tenY    = tok * (Math.pow(1+apy,10)-1);

  const rows = [
    ["Jour",    daily,   p? daily*p:0,         p? (tok*p + daily*p):0],
    ["Mois",    monthly, p? monthly*p:0,       p? (tok*p + monthly*p):0],
    ["An",      yearly,  p? yearly*p:0,        p? (tok*p + yearly*p):0],
    ["5 ans",   fiveY,   p? fiveY*p:0,         p? (tok*p + fiveY*p):0],
    ["10 ans",  tenY,    p? tenY*p:0,          p? (tok*p + tenY*p):0],
  ];
  $tableBody.innerHTML = rows.map(r => `
    <tr>
      <td>${r[0]}</td>
      <td class="good">${fmtTok(r[1])} ${S.selected}</td>
      <td>${fmtFiat(r[2])}</td>
      <td><strong>${fmtFiat(r[3])}</strong></td>
    </tr>`).join('');
}

function computeSeriesEUR(tok, apy, p){
  const months = 120;
  const data = [];
  for(let m=0;m<=months;m++){
    const tokens = tok * Math.pow(1+apy, m/12);
    data.push(tokens * (p||0));
  }
  return data;
}

/* Courbe améliorée : gradient, aplat, points clés */
function drawChart(data){
  const ctx = $canvas.getContext('2d');
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const Wcss = $canvas.clientWidth || 900, Hcss = $canvas.clientHeight || 320;
  $canvas.width = Math.round(Wcss*dpr); $canvas.height = Math.round(Hcss*dpr);
  ctx.scale(dpr,dpr);

  // fond
  ctx.fillStyle = getComputedStyle(document.body).backgroundColor || '#0B0B0D';
  ctx.fillRect(0,0,Wcss,Hcss);

  // grille
  ctx.strokeStyle = 'rgba(159,180,255,0.14)';
  ctx.lineWidth = 1;
  const gx=10, gy=6;
  for(let i=0;i<=gx;i++){ const x=i*Wcss/gx; ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,Hcss); ctx.stroke(); }
  for(let i=0;i<=gy;i++){ const y=i*Hcss/gy; ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(Wcss,y); ctx.stroke(); }

  // axes / échelle
  const max = Math.max(...data) || 1;
  const pad = 14;
  const X = (i)=> pad + (Wcss-2*pad) * (i/(data.length-1));
  const Y = (v)=> Hcss - pad - (Hcss-2*pad) * (v/max);

  // aplat gradient sous la courbe
  const grad = ctx.createLinearGradient(0,0,0,Hcss);
  grad.addColorStop(0,'rgba(47,227,255,0.35)');
  grad.addColorStop(1,'rgba(27,76,255,0.00)');

  ctx.beginPath();
  data.forEach((v,i)=>{ const x=X(i), y=Y(v); i? ctx.lineTo(x,y): ctx.moveTo(x,y); });
  ctx.lineTo(Wcss-pad,Hcss-pad); ctx.lineTo(pad,Hcss-pad); ctx.closePath();
  ctx.fillStyle = grad; ctx.fill();

  // ligne principale (glow)
  ctx.shadowColor = 'rgba(47,227,255,.55)';
  ctx.shadowBlur = 8;
  ctx.strokeStyle = '#2FE3FF';
  ctx.lineWidth = 2;
  ctx.beginPath();
  data.forEach((v,i)=>{ const x=X(i), y=Y(v); i? ctx.lineTo(x,y): ctx.moveTo(x,y); });
  ctx.stroke();
  ctx.shadowBlur = 0;

  // points clés
  const dots=[0,24,60,120];
  ctx.fillStyle = '#E6ECF7';
  dots.forEach(i=>{
    const x=X(i), y=Y(data[i]);
    ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
  });

  // dernier label
  const last = data[data.length-1] || 0;
  ctx.fillStyle = '#E6ECF7';
  ctx.font = '12px Inter';
  ctx.fillText(fmtFiat(last), Wcss-120, 20);
}

function recalcAll(){
  const t = tokenBySym(S.selected);
  const apy = t.apy;
  const p = priceEUR(S.selected)||0;
  $priceNow.value = p? p.toFixed(2) : '—';
  const tok = parseFloat($tok.value)||0;

  buildTable(tok, apy, p);
  drawChart(computeSeriesEUR(tok, apy, p));
}

async function syncAll(){
  $lastUpdate.value = 'Synchronisation…';
  try{
    await fetchPrices();
    const p = priceEUR(S.selected)||0;
    $priceNow.value = p? p.toFixed(2) : '—';
    S.lastTs = new Date();
    $lastUpdate.value = S.lastTs.toLocaleString('fr-FR');
  }catch(e){
    $lastUpdate.value = 'Synchro partielle';
  }
  syncTokenFromEUR(); recalcAll();
}

/* Events */
document.getElementById('syncBtn').addEventListener('click', syncAll);
$sel.addEventListener('change', e=> selectToken(e.target.value));
$eur.addEventListener('input', ()=>{ syncTokenFromEUR(); recalcAll(); });
$tok.addEventListener('input', ()=>{ syncEURFromToken(); recalcAll(); });

/* --------------------------- INIT --------------------------- */
function init(){
  selectToken('ETH'); // set defaults & unit
  $eur.value = 1000;  // valeur de démo
  syncAll();
  renderLesson();
}
init();
</script>
</body>
</html>
